{"version":3,"file":"next-swagger-doc.cjs.development.js","sources":["../src/with-swagger.ts"],"sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next';\nimport { join } from 'path';\n\nimport swaggerJsdoc, { Options } from 'swagger-jsdoc';\n\ntype SwaggerOptions = Options & {\n  apiFolder?: string;\n};\n\nconst defaultOptions: SwaggerOptions = {\n  apiFolder: 'pages/api',\n  definition: {\n    openapi: '3.0.0',\n    info: {\n      title: 'Demo Api',\n      version: '1.0',\n    },\n  },\n};\n\n/**\n * Create swagger JSON\n * @param options.openApiVersion Open API version {3.0.0}\n * @param options.apiFolder NextJS API folder {pages/api}\n * @param options.title Title\n * @param options.version Version\n * @returns Swagger JSON Spec\n */\nexport function createSwaggerSpec({\n  apiFolder = 'pages/api',\n  ...swaggerOptions\n}: SwaggerOptions = defaultOptions) {\n  const apiDirectory = join(process.cwd(), apiFolder);\n  const buildApiDirectory = join(process.cwd(), '.next/server', apiFolder);\n\n  const options: Options = {\n    ...swaggerOptions,\n    apis: [\n      `${apiDirectory}/**/*.js`,\n      `${apiDirectory}/**/*.ts`,\n      `${apiDirectory}/**/*.tsx`,\n      `${buildApiDirectory}/**/*.js`,\n    ], // files containing annotations as above\n  };\n\n  return swaggerJsdoc(options);\n}\n\n/**\n * withSwagger middleware\n * @param options.openApiVersion Open API version {3.0.0}\n * @param options.apiFolder NextJS API folder {pages/api}\n * @param options.title Title\n * @param options.version Version\n * @returns\n */\nexport function withSwagger({\n  apiFolder = 'pages/api',\n  ...swaggerOptions\n}: SwaggerOptions = defaultOptions) {\n  return () => {\n    return (_req: NextApiRequest, res: NextApiResponse) => {\n      try {\n        const swaggerSpec = createSwaggerSpec({\n          apiFolder,\n          ...swaggerOptions,\n        });\n        res.status(200).send(swaggerSpec);\n      } catch (error) {\n        res.status(400).send(error);\n      }\n    };\n  };\n}\n"],"names":["defaultOptions","apiFolder","definition","openapi","info","title","version","createSwaggerSpec","swaggerOptions","apiDirectory","join","process","cwd","buildApiDirectory","options","apis","swaggerJsdoc","withSwagger","_req","res","swaggerSpec","status","send","error"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASA,IAAMA,cAAc,GAAmB;AACrCC,EAAAA,SAAS,EAAE,WAD0B;AAErCC,EAAAA,UAAU,EAAE;AACVC,IAAAA,OAAO,EAAE,OADC;AAEVC,IAAAA,IAAI,EAAE;AACJC,MAAAA,KAAK,EAAE,UADH;AAEJC,MAAAA,OAAO,EAAE;AAFL;AAFI;AAFyB,CAAvC;AAWA;;;;;;;;;SAQgBC;gCAGIP;4BAFlBC;MAAAA,wCAAY;MACTO;;AAEH,MAAMC,YAAY,GAAGC,SAAI,CAACC,OAAO,CAACC,GAAR,EAAD,EAAgBX,SAAhB,CAAzB;AACA,MAAMY,iBAAiB,GAAGH,SAAI,CAACC,OAAO,CAACC,GAAR,EAAD,EAAgB,cAAhB,EAAgCX,SAAhC,CAA9B;;AAEA,MAAMa,OAAO,gBACRN,cADQ;AAEXO,IAAAA,IAAI,EAAE,CACDN,YADC,eAEDA,YAFC,eAGDA,YAHC,gBAIDI,iBAJC;AAFK,IAAb;;AAUA,SAAOG,YAAY,CAACF,OAAD,CAAnB;AACD;AAED;;;;;;;;;SAQgBG;kCAGIjB;8BAFlBC;MAAAA,yCAAY;MACTO;;AAEH,SAAO;AACL,WAAO,UAACU,IAAD,EAAuBC,GAAvB;AACL,UAAI;AACF,YAAMC,WAAW,GAAGb,iBAAiB;AACnCN,UAAAA,SAAS,EAATA;AADmC,WAEhCO,cAFgC,EAArC;AAIAW,QAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,WAArB;AACD,OAND,CAME,OAAOG,KAAP,EAAc;AACdJ,QAAAA,GAAG,CAACE,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBC,KAArB;AACD;AACF,KAVD;AAWD,GAZD;AAaD;;;;;"}