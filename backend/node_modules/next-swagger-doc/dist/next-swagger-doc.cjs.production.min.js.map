{"version":3,"file":"next-swagger-doc.cjs.production.min.js","sources":["../src/with-swagger.ts"],"sourcesContent":["import { NextApiRequest, NextApiResponse } from 'next';\nimport { join } from 'path';\n\nimport swaggerJsdoc, { Options } from 'swagger-jsdoc';\n\ntype SwaggerOptions = Options & {\n  apiFolder?: string;\n};\n\nconst defaultOptions: SwaggerOptions = {\n  apiFolder: 'pages/api',\n  definition: {\n    openapi: '3.0.0',\n    info: {\n      title: 'Demo Api',\n      version: '1.0',\n    },\n  },\n};\n\n/**\n * Create swagger JSON\n * @param options.openApiVersion Open API version {3.0.0}\n * @param options.apiFolder NextJS API folder {pages/api}\n * @param options.title Title\n * @param options.version Version\n * @returns Swagger JSON Spec\n */\nexport function createSwaggerSpec({\n  apiFolder = 'pages/api',\n  ...swaggerOptions\n}: SwaggerOptions = defaultOptions) {\n  const apiDirectory = join(process.cwd(), apiFolder);\n  const buildApiDirectory = join(process.cwd(), '.next/server', apiFolder);\n\n  const options: Options = {\n    ...swaggerOptions,\n    apis: [\n      `${apiDirectory}/**/*.js`,\n      `${apiDirectory}/**/*.ts`,\n      `${apiDirectory}/**/*.tsx`,\n      `${buildApiDirectory}/**/*.js`,\n    ], // files containing annotations as above\n  };\n\n  return swaggerJsdoc(options);\n}\n\n/**\n * withSwagger middleware\n * @param options.openApiVersion Open API version {3.0.0}\n * @param options.apiFolder NextJS API folder {pages/api}\n * @param options.title Title\n * @param options.version Version\n * @returns\n */\nexport function withSwagger({\n  apiFolder = 'pages/api',\n  ...swaggerOptions\n}: SwaggerOptions = defaultOptions) {\n  return () => {\n    return (_req: NextApiRequest, res: NextApiResponse) => {\n      try {\n        const swaggerSpec = createSwaggerSpec({\n          apiFolder,\n          ...swaggerOptions,\n        });\n        res.status(200).send(swaggerSpec);\n      } catch (error) {\n        res.status(400).send(error);\n      }\n    };\n  };\n}\n"],"names":["defaultOptions","apiFolder","definition","openapi","info","title","version","createSwaggerSpec","swaggerOptions","apiDirectory","join","process","cwd","options","apis","swaggerJsdoc","_req","res","swaggerSpec","status","send","error"],"mappings":"6fASA,IAAMA,EAAiC,CACrCC,UAAW,YACXC,WAAY,CACVC,QAAS,QACTC,KAAM,CACJC,MAAO,WACPC,QAAS,kBAaCC,sBAGIP,QAFlBC,UAAAA,aAAY,cACTO,qBAEGC,EAAeC,OAAKC,QAAQC,MAAOX,GAGnCY,OACDL,GACHM,KAAM,CACDL,aACAA,aACAA,cAPmBC,OAAKC,QAAQC,MAAO,eAAgBX,wBAYvDc,EAAaF,gFAcFb,QAFlBC,UAAAA,aAAY,cACTO,4BAEI,kBACE,SAACQ,EAAsBC,WAEpBC,EAAcX,KAClBN,UAAAA,GACGO,IAELS,EAAIE,OAAO,KAAKC,KAAKF,GACrB,MAAOG,GACPJ,EAAIE,OAAO,KAAKC,KAAKC"}